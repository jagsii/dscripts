exports=async function(url,bid,cid,options){const{collectLines}=await require("transcode/parse_content"),absoluteUrl=require("utils/absolute_url"),{send}=require("http");let response=await send(url,options?.clientOptions);assertOK(response);let html=response.body;const hash=html.subRegex(/hash ?= ?"(?<hash>[^"]+)"/);if(!hash)return null;response=await send({url:absoluteUrl("/home/index/ajaxchapter",url),method:"POST",body:"id="+bid+"&eKey="+hash+"&cid="+cid+"&basecid="+cid,headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8","x-requested-with":"XMLHttpRequest",referer:url}}),assertOK(response),html=response.body;const json=JSON.parse(html);if(json.info&&json.info.content){const _=[];if(collectLines(json.info.content,_),4<_.length)for(let i=_.length-1;0<i;i--)if(!/请大家收藏新地址|请下载.+最新(?:内容|章节)|为你提供.+更新.+\w+\.\w+/.test(_[i])){i<_.length-1&&_.splice(i+1,_.length-i-1);break}return formatBookContent(_)}return null};