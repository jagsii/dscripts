exports=async function(url,bid,cid,options){const{trimContentFragment,extractFragment,collectLines}=await require("transcode/parse_content");let cookie="";const{send}=require("http");let page=0;const result=[];for(;10>page++;){const u=1==page?url:url.replace(".html",`_${page}.html`);let h={};cookie&&(h.cookie=cookie);let response=await send({url:u,headers:h},options.clientOptions);assertOK(response);let html=response.body,setCookies=response.headers["set-cookie"];setCookies&&(cookie=setCookies.split(",").map(_=>_.split(";")[0]+"; ").join("")+cookie);let fragment=await extractFragment(html,{cleaner:html=>trimContentFragment(html,/id="htmlContent"[^>]*>/)});if(fragment=fragment.replace(/<p id="contentTip"[^>]*>[^<]+<\/p>/,""),/setTimeout\('getPageData/.test(html)){const m=/id="subFrom"[^>]*>/.exec(html);if(m){let f=html.substring(m.index);f=f.substring(0,f.indexOf("</form>"));const form=f.subRegexMapAll(/name=['"](?<name>[^'"]+)['"] value=['"](?<value>[^'"]+)['"]/g),body=form.map(_=>`${_.name}=${_.value}`).join("&"),{send}=require("http"),absoluteUrl=require("utils/absolute_url"),response=await send({url:absoluteUrl(`/get-page-data?${Math.random()}`,url),method:"POST",body,headers:{Referer:u,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/javascript, */*; q=0.01",cookie}});assertOK(response);const h=response.body,json=JSON.parse(h);1==json.status&&""!=json.data&&(fragment+=json.data);}}if(collectLines(fragment,result),0<result.length&&/未完.+下一页继续阅读/.test(result.last)&&result.pop(),!/href="[^'"]*\/[a-z]+\/[a-zA-Z\d_-]+\/\d+_\d+\.html" class=['"]next/.exec(html))break}return formatBookContent(result)};