exports=async function(a,b,c,d){const{trimContentFragment:e,extractFragment:f,collectLines:g}=await require("transcode/parse_content");let i="";const{send:j}=require("http");let k=0;const l=[];for(;10>k++;){const b=1==k?a:a.replace(".html",`_${k}.html`);let c={};i&&(c.cookie=i);let h=await j({url:b,headers:c},d.clientOptions);assertOK(h);let n=h.body,o=h.headers["set-cookie"];o&&(i=o.split(",").map(a=>a.split(";")[0]+"; ").join("")+i);let p=await f(n,{cleaner:a=>e(a,/id="htmlContent"[^>]*>/)});if(p=p.replace(/<p id="contentTip"[^>]*>[^<]+<\/p>/,""),/setTimeout\('getPageData/.test(n)){const c=/id="subFrom"[^>]*>/.exec(n);if(c){let d=n.substring(c.index);d=d.substring(0,d.indexOf("</form>"));const e=d.subRegexMapAll(/name=['"](?<name>[^'"]+)['"] value=['"](?<value>[^'"]+)['"]/g),f=e.map(a=>`${a.name}=${a.value}`).join("&"),{send:g}=require("http"),j=require("utils/absolute_url"),k=await g({url:j(`/get-page-data?${Math.random()}`,a),method:"POST",body:f,headers:{Referer:b,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/javascript, */*; q=0.01",cookie:i}});assertOK(k);const l=k.body,h=JSON.parse(l);1==h.status&&""!=h.data&&(p+=h.data);}}if(g(p,l),0<l.length&&/未完.+下一页继续阅读/.test(l.last)&&l.pop(),!/href="[^'"]*\/[a-z]+\/[a-zA-Z\d_-]+\/\d+_\d+\.html" class=['"]next/.exec(n))break}return formatBookContent(l)};