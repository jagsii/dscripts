exports=async function(a,b,c,d){function e(){var b=String.fromCharCode;this.encode=function(l){var m,n,o,p,q,r,s,t="",u=0;for(l=_utf8_encode(l);u<l.length;)m=l.charCodeAt(u++),n=l.charCodeAt(u++),o=l.charCodeAt(u++),p=m>>2,q=(3&m)<<4|n>>4,r=(15&n)<<2|o>>6,s=63&o,isNaN(n)?r=s=64:isNaN(o)&&(s=64),t=t+k.charAt(p)+k.charAt(q)+k.charAt(r)+k.charAt(s);return t},this.decode=function(l){var m,n,o,p,q,r,s,t="",u=0;for(l=l.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<l.length;)p=k.indexOf(l.charAt(u++)),q=k.indexOf(l.charAt(u++)),r=k.indexOf(l.charAt(u++)),s=k.indexOf(l.charAt(u++)),m=p<<2|q>>4,n=(15&q)<<4|r>>2,o=(3&r)<<6|s,t+=b(m),64!=r&&(t+=b(n)),64!=s&&(t+=b(o));return t=_utf8_decode(t)},_utf8_encode=function(e){var f,g,h;for(e=e.replace(/\r\n/g,"\n"),f="",g=0;g<e.length;g++)h=e.charCodeAt(g),128>h?f+=b(h):127<h&&2048>h?(f+=b(192|h>>6),f+=b(128|63&h)):(f+=b(224|h>>12),f+=b(128|63&h>>6),f+=b(128|63&h));return f},_utf8_decode=function(e){for(var a="",f=0,g=c1=c2=0;f<e.length;)g=e.charCodeAt(f),128>g?(a+=b(g),f++):191<g&&224>g?(c2=e.charCodeAt(f+1),a+=b((31&g)<<6|63&c2),f+=2):(c2=e.charCodeAt(f+1),c3=e.charCodeAt(f+2),a+=b((15&g)<<12|(63&c2)<<6|63&c3),f+=3);return a};}function f(a,b){function c(a){return decodeURIComponent(atob(a).split("").map(function(a){return "%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join(""))}const d=a.subRegex(/var contentFull\s*=\s*'([^']+)'/),e=a.subRegexMapAll(/contentFull\.replace\(new RegExp\(Decode64\("(?<a>[^"]+)"\),'g'\),Decode64\("(?<b>[^"]+)"\)\)/g);let f=c(d);for(let d of e)f=f.replace(new RegExp(c(d.a),"g"),c(d.b));h(f,b);}const{parseContentPaginate:g,collectLines:h}=await require("transcode/parse_content"),k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";const{send:l}=require("http"),m={...(d&&d.clientOptions)},n=await l(a,m);assertOK(n);const o=n.body;if(/var contentFull\s*=\s*'([^']+)'/.test(o))return async function(a){const d=[];f(a,d);for(let e=2;;){const a=await l(`https://www.xxdingdian.com/book/${b}/${c}_${e}.html`,m);assertOK(a);const g=a.body;if(f(g,d),!/id="A3" href="\/book\/\d+\/\d+_\d+\.html"/.test(g)||20<e++)break}return d}(o);const p=o.subRegexMap(/get_contents\('(?<bid>\d+)','(?<cid>\d+)','(?<pid>\d+)','(?<page_count>\d+)','[^']*','[^']*','(?<type>[^']*)'\)/);if(!p)return null;const q={headers:{Accept:"text/javascript, application/javascript, application/x-javascript",Referer:a,"Content-Type":"application/x-www-form-urlencoded","x-requested-with":"XMLHttpRequest"},method:"POST",body:""},r=parseInt(p.page_count);let s=!1;return g(b=>(s=b<r,q.body=`aid=${p.bid}&cid=${p.cid}&pid=${b}&page_count=${p.page_count}&getcontent=1&type=${p.type}`,q.headers.Referer=1===b?a:a.replace(".html",`_${b}.html`),`https://www.xxdingdian.com/report.php?_=${new Date().getTime()}`),"div#content",{httpOptions:q,clientOptions:m,hasNextFn:()=>s,parser:a=>{let b=a.subRegex(/var txt="([^"]+)"/);const c=a.subRegexMapAll(/\w+\.decode\("(?<s>[^"]+)"\),'g'\),\w+\.decode\("(?<r>[^"]+)"\)/g),d=new e;b=d.decode(b);for(let e of c)b=b.replace(new RegExp(d.decode(e.s),"g"),d.decode(e.r));return b.split("<br>")}})};