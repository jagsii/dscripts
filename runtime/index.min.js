String.prototype.matchAll||(String.prototype.matchAll=function(a){let b;const c=[];for(;null!==(b=a.exec(this));)c.push(b);return c[Symbol.iterator]()}),"undefined"==typeof globalThis&&("undefined"==typeof window?"undefined"==typeof global?"undefined"!=typeof self&&(self.globalThis=self):global.globalThis=global:window.globalThis=window),String.prototype.intValue||(String.prototype.intValue=function(){try{return parseInt(this)}catch(a){return null}}),String.prototype.subRegex||(String.prototype.subRegex=function(a){const b=a.exec(this);return null==b?null:b[1]}),String.prototype.subRegexFirst||(String.prototype.subRegexFirst=function(a){const b=a.exec(this);if(null==b)return null;for(let c=1;c<b.length;c++)if(b[c]!==void 0)return b[c];return null}),String.prototype.subRegexLast||(String.prototype.subRegexLast=function(a){if(-1===a.flags.indexOf("g"))throw "subRegexLast regex flag must include g";let b,c;for(;null!==(b=a.exec(this));)c=b;return c?c[1]:null}),String.prototype.subRegexMapAll||(String.prototype.subRegexMapAll=function(a){if(-1===a.flags.indexOf("g"))throw "subRegexMapAll regex flag must include g";const b=[];for(let c;null!==(c=a.exec(this));){let a;for(let b in c.groups)void 0!==c.groups[b]&&(void 0===a&&(a={}),a[b]=c.groups[b]);a!==void 0&&b.push(a);}return b}),String.prototype.subRegexAll||(String.prototype.subRegexAll=function(a){if(-1===a.flags.indexOf("g"))throw "subRegexAll regex flag must include g";const b=[];for(let c;null!==(c=a.exec(this));)for(let a=1;a<c.length;a++)if(c[a]!==void 0){b.push(c[a]);break}return b}),String.prototype.subRegexMap||(String.prototype.subRegexMap=function(a){const b={};if(-1===a.flags.indexOf("g")){const c=a.exec(this);if(null!=c)for(let a in c.groups)void 0!==c.groups[a]&&(b[a]=c.groups[a]);}else {const c=this.matchAll(a);for(let a of c)for(let c in a.groups)if(a.groups[c]!==void 0){b[c]=a.groups[c];break}}return b}),String.prototype.contains||(String.prototype.contains=function(a){return -1!==this.indexOf(a)}),String.prototype.indexOfRegex||(String.prototype.indexOfRegex=function(a){const b=a.exec(this);return b?b.index:-1}),String.prototype.lastIndexOfRegex||(String.prototype.lastIndexOfRegex=function(a){let b,c;for(;null!==(b=a.exec(this));)c=b;return c?c.index:-1}),String.prototype.subIndexOf||(String.prototype.subIndexOf=function(a){if(a instanceof RegExp){const b=a.exec(this);return b?this.substring(b.index+b[0].length):this}const b=this.indexOf(a);return -1===b?this:this.substring(b+a.length)}),String.prototype.subLastIndexOf||(String.prototype.subLastIndexOf=function(a){if(a instanceof RegExp){if(-1===a.flags.indexOf("g"))throw "subLastIndexOf regex flag must include g";let b,c=-1;for(;null!=(b=a.exec(this));)c=b.index+b[0].length;return -1===c?this:this.substring(c)}const b=this.lastIndexOf(a);return -1===b?this:this.substring(b+a.length)}),String.prototype.toIndexOf||(String.prototype.toIndexOf=function(a){if(a instanceof RegExp){const b=a.exec(this);return b?this.substring(0,b.index):this}const b=this.indexOf(a);return -1===b?this:this.substring(0,b)}),String.prototype.toLastIndexOf||(String.prototype.toLastIndexOf=function(a){const b=this.lastIndexOf(a);return -1===b?this:this.substring(0,b)}),String.prototype.idPrefix||(String.prototype.idPrefix=function(){return 3<this.length?this.substring(0,this.length-3):"0"}),String.prototype.trimHTMLSpace||(String.prototype.trimHTMLSpace=function(){return trimHTMLSpace(this)}),Array.prototype.first||Object.defineProperty(Array.prototype,"first",{get(){return 0===this.length?void 0:this[0]},set(a){this[0]=a;},enumerable:!1}),Array.prototype.last||Object.defineProperty(Array.prototype,"last",{get(){return 0===this.length?void 0:this[this.length-1]},set(a){this[this.length-1]=a;},enumerable:!1}),globalThis.reverseRange=function(a,b,c){for(let d=b;d<c;d++){const e=b+c-d-1;if(e<=d)break;let f=a[d];a[d]=a[e],a[e]=f;}return a},globalThis.delay=async function(a){return new Promise(b=>{setTimeout(()=>b(),a);})},globalThis.stat===void 0&&(globalThis.stat=function(){}),globalThis.assertOK=function(a){if(200>a.statusCode||299<a.statusCode)throw new Error(`Request failed with statusCode ${a.statusCode}, ${a.reasonPhrase}`)},globalThis.isCloudFlareBlocked=function(a){return (403===a.statusCode||522===a.statusCode)&&null!=a.headers["cf-ray"]},globalThis.isBlocked=function(a){return 0===a.statusCode&&(-1!==a.reasonPhrase?.indexOf("Connection terminated during handshake")||-1!==a.reasonPhrase?.indexOf("Connection closed before full header was received"))},globalThis.handleRequestRetry=async function(a,b,c,d,e){for(let f=0;!0===(await e(a,b,c,f))&&3>f++;)a=await d(b,c);return a},globalThis.formatTags=function(a){return a.split(/[\s,]/).map(a=>a.trim()).filter(a=>0<a.length).join(",")},globalThis.cleanHTMLComments=function(a){return a.replace(/<!--[\S\s]*?-->/g,"")},globalThis.cleanHTMLScripts=function(a){return a.replace(/<script(?: [^>]+)?>(?:'[^']*'|"[^"]*"|<[^\/]|[^<'"])*<\/script>/ig,"")},globalThis.cleanHTML=function(a){return cleanHTMLScripts(cleanHTMLComments(a))},globalThis.Utils={getUrlPath(a){let b=a;(a.startsWith("http:")||a.startsWith("https:"))&&(b=a.substring(a.indexOf("/")));let c=b.indexOf("?");return -1!==c&&(b=b.substring(0,c)),c=b.indexOf("#"),-1!==c&&(b=b.substring(0,c)),b}};const itoc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ctoi={};for(let a=0;66>a;a++)ctoi[itoc.charAt(a)]=a;globalThis.atob=function(a){var b=String.fromCharCode;let c,d,e=(a+"").replace(/[\t\n\f\r ]+/g,""),f="",g=0,h=0;if(0==e.length%4&&(e=e.replace(/[=]+$/,"")),1==e.length%4||/[^\d+/a-z]/i.exec(e))throw new Error("The string is not correctly encoded");for(;c=e.charAt(g++);)ctoi.hasOwnProperty(c)&&(d=h%4?64*d+ctoi[c]:ctoi[c],h++%4&&(f+=b(255&d>>(6&-2*h))));return f},globalThis.btoa=function(a){let b,c,d=a+"",e="",f=0,g=itoc;for(;d.charAt(f)||(g="=",f%1);){if(c=d.charCodeAt(f+=3/4),255<c)throw new Error("The string contains characters outside of the Latin1 range");b=b<<8|c,e+=g.charAt(63&b>>8-8*(f%1));}return e},globalThis.lvtCookie=function(a){const b=new Date().getTime().toString().substring(0,10);return `Hm_lvt_${a}=${b}; Hm_lpvt_${a}=${b}`},globalThis.getHtml=async function(a,b){const{send:c}=require("http"),d=await c(a,b);return assertOK(d),d.body};function calcAgoOffset(a){const b=/\s*-?([\d.]+)\s*个?([秒分钟小时天日周星期月年]+)\s*(?:[以之]?前)?\s*/.exec(a);if(null==b)return null;const c=parseFloat(b[1]),d=b[2];let e;switch(d){case"\u79D2":e=1e3*c;break;case"\u5206":case"\u5206\u949F":e=6e4*c;break;case"\u65F6":case"\u5C0F\u65F6":e=36e5*c;break;case"\u5929":case"\u65E5":e=36e5*(24*c);break;case"\u5468":case"\u661F\u671F":e=36e5*(24*(7*c));break;case"\u6708":e=36e5*(24*(30*c));break;case"\u5E74":e=36e5*(24*(365*c));break;default:return null;}return e}function parseAgo(a){if("\u521A\u521A"==a)return new Date;const b=calcAgoOffset(a);if(null==b)return null;const c=new Date().getTime();return new Date(c-Math.trunc(b))}function applyDateValue(a,b){if(b.y!==void 0){const c=parseInt(b.y);a.setFullYear(100>c?100*Math.trunc(a.getFullYear()/100)+c:c);}b.M!==void 0&&a.setMonth(parseInt(b.M)-1),b.d!==void 0&&a.setDate(parseInt(b.d)),a.setHours(b.H===void 0?0:parseInt(b.H),b.m===void 0?0:parseInt(b.m),b.s===void 0?0:parseInt(b.s)),-480!==a.getTimezoneOffset()&&a.setTime(a.getTime()+6e4*(-480+a.getTimezoneOffset()));}function tryParseDate(a){const b=a.subRegexMap(/(?:(?<y>\d{2,4})[-\/年])?(?<M>\d{1,2})[-\/月](?<d>\d{1,2})/),c=a.subRegexMap(/(?<H>\d{1,2})[:时](?<m>\d{1,2})(?:[:分](?<s>\d{1,2})?)?/),d={...b,...c};if(0<Object.keys(d).length){const a=new Date;return applyDateValue(a,d),a}return null}globalThis.parseDate=function(a,b){function c(a){return 48<=a&&57>=a}a=a.trim();let d;if("timestamp"===b)return 13<a.length&&(a=a.substring(0,13)),13===a.length?new Date(parseInt(a)):10===a.length?new Date(1e3*parseInt(a)):null;if("ago"===b&&(d=parseAgo(a),d))return d;if(a.endsWith("\u524D"))return parseAgo(a);if(null==b||/(?:(?<y1>y{2,4})[-\/年])?(?<M1>M{1,2})[-\/月](?<d1>d{1,2})|(?<H1>H{1,2})[:时](?<m1>m{1,2})(?:[:分](?<s1>s{1,2})?)?/.test(b))return tryParseDate(a);const e=[];for(let c;null!=(c=/y{2,4}|M{1,2}|d{1,2}|H{1,2}|m{1,2}|s{1,2}/g.exec(b));)e.push({f:c[0],start:c.index});if(0===e.length)return null;let f=0;const g={};for(let d of e){let b=d.start+f;if(!c(a.charCodeAt(b)))return null;if("y"===d.f.charAt(0)){g.y=a.substring(b,b+d.f.length).intValue();continue}1===d.f.length&&b+1<a.length?c(a.charCodeAt(b+1))?(g[d.f.charAt(0)]=a.substring(b,b+2).intValue(),f++):g[d.f.charAt(0)]=a.substring(b,b+1).intValue():g[d.f.charAt(0)]=a.substring(b,b+2).intValue();}if(0<Object.keys(g).length){const a=new Date;return applyDateValue(a,g),a}return null},globalThis.trimHTMLSpace=function(a){return a.replace(/^([\s　]|&(nb|e[nm]|num|punc|thin)sp(1[34])?;|&#160;|&#819[4-9];|<br\s*\/?>)+/i,"").replace(/([\s　]|&(nb|e[nm]|num|punc|thin)sp(1[34])?;|&#160;|&#819[4-9];|<br\s*\/?>)+$/,"")};function singlifySpace(a){return a.replace(/[\s　]+/g," ")}globalThis.formatInfo=function(a){const{unescape:b}=require("html");return a.name&&(a.name=singlifySpace(b(a.name)).trimHTMLSpace()),a.author&&(a.author=singlifySpace(b(a.author)).trimHTMLSpace()),a.intro&&(a.intro=b(a.intro.replace(/&amp;/g,"&")).trimHTMLSpace().replace(/[ 　\t]/g," ").replace(/\r|\\r|\\n|<\/?[bB][rR] ?\/?>|<\/?[pP][^>]*>|\s{2,}/g,"\n").split("\n").filter(a=>0<a.length).join("\n")),a},globalThis.formatUpdate=function(a){if(a.name){const{unescape:b}=require("html");a.name=singlifySpace(b(a.name)).trimHTMLSpace();}return a},globalThis.formatVideoUpdate=function(a){if(0===a.updates.length)return a;const{unescape:b}=require("html");for(let c of a.updates)c.name&&(c.name=singlifySpace(b(c.name)).trimHTMLSpace());return a},globalThis.formatCatalog=function(a){function b(a){for(let b of a)b.name&&(b.name=singlifySpace(c(b.name)).trimHTMLSpace()),b.volume&&(b.volume=singlifySpace(c(b.volume)).trimHTMLSpace());}const{unescape:c}=require("html");if(a instanceof Array)return b(a),a;if(a.hasOwnProperty("catalog")&&a.catalog instanceof Array)return b(a.catalog),a;if(a.hasOwnProperty("catalogs")&&a.catalogs instanceof Array){for(let c of a.catalogs)b(c.catalog);return a}return a},globalThis.formatBookContent=function(a){const b=a instanceof Array,c=b?a:a.content;if(0===c.length)return a;const{unescape:d}=require("html"),e=[];for(let b of c){let a=d(b.replace(/&amp;/g,"&")).replace(/(\w)[  　]{2,}(\w)/g,(a,b,c)=>b+" "+c).replace(/\r|<\/?[bB][rR] ?\/?>|<\/?[pP][^>]*>|[ 　\s]{2,}/g,"\n").replace(/[ 　]/g," ");if(-1===a.indexOf("\n"))a=a.trimHTMLSpace(),0<a.length&&e.push(a);else for(let b of a.split("\n"))b=b.trimHTMLSpace(),0<b.length&&e.push(b);}return b?e:(a.content=e,a)};