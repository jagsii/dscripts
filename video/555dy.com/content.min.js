exports=async function(url,bid,cid,options){var _Mathround=Math.round;function encryptPackData(data,keys){let[secretKey,iv]=keys;const text=CryptoJS.enc.Utf8.parse(data),encrypted=CryptoJS.AES.encrypt(text,secretKey,{iv:iv,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});return encrypted.ciphertext.toString().toUpperCase()}function decryptPackData(data,keys){let[secretKey,iv]=keys;const cipherData=CryptoJS.enc.Hex.parse(data),text=CryptoJS.enc.Base64.stringify(cipherData),decrypted=CryptoJS.AES.decrypt(text,secretKey,{iv:iv,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});return decrypted.toString(CryptoJS.enc.Utf8)}const{send}=require("http"),CryptoJS=(await require("third-party/crypto-js"))(["aes","hmac","sha256"]),absoluteUrl=require("utils/absolute_url"),clientOptions={encoding:"utf-8",...options.clientOptions};let response;if(response=await send(url,clientOptions),200>response.statusCode||299<response.statusCode)throw new Error(`Request failed with statusCode ${response.statusCode}, ${response.reasonPhrase}`);let html=response.body,matcher=/var player_aaaa=({[^<]+})<\/script>(?:\s*<div[^>]*>)+\s*<iframe [^>]*src="([^"]+)"[^>]+allow="autoplay"/.exec(html);if(!matcher)return null;const playData=JSON.parse(matcher[1].trim()),videoId=playData.url;if(!videoId)return null;const url2=absoluteUrl(matcher[2],url);if(response=await send({url:url2,headers:{referer:url}},clientOptions),200>response.statusCode||299<response.statusCode)throw new Error(`Request failed with statusCode ${response.statusCode}, ${response.reasonPhrase}`);html=response.body,matcher=/servers\s*=\s*\[([^\[\]]+)]/.exec(html);let server_url;if(matcher){const servers=matcher[1].split(",").map(_=>_.replace(/['"]/g,"").trim());server_url=servers[0];}else matcher=/server_url\s?=\s?['"]([^'"]+)['"]/.exec(html),matcher&&(server_url=matcher[1]);if(!server_url)return null;if(server_url.startsWith("ws")){const getKeys=function(){return [CryptoJS.enc.Utf8.parse("55ca5c48a943afdc"),CryptoJS.enc.Utf8.parse("d11424dcecfe16c0")]},sign=function(str){return CryptoJS.HmacSHA256(str,"55ca5c4d11424dcecfe16c08a943afdc").toString()}(videoId),requestData=function(str){const array=new Uint8Array(str.length);for(let i=0;i<str.length;i++)array[i]=str.charCodeAt(i);return array.buffer}(encryptPackData(JSON.stringify({type:"getUrl",url:videoId,sign:sign}),getKeys()));let client;const data=await new Promise((resolve,reject)=>{const WebSocketClient=require("websocket_client");client=new WebSocketClient(server_url,null,{headers:{Origin:url2},onopen:function(){client.send(requestData);},onerror:function(){null!=client&&client.close(),reject();},onmessage:function(data){resolve(data);}});});null!=client&&client.close();let result=JSON.parse(decryptPackData(data,getKeys()));return "url"!==result.type||result.url?{url:result.url}:null}else {const getKeys=function(){return [CryptoJS.enc.Utf8.parse("55cc5c42a943afdc"),CryptoJS.enc.Utf8.parse("d11324dcscfe16c0")]},url3=server_url+"/get_play_url",_0xe71271=_Mathround(new Date().getTime()/1e3),_0x24a30a=CryptoJS.MD5(server_url+"GET"+_0xe71271+"55ca5c4d11424dcecfe16c08a943afdc").toString(),_0x51a035=encryptPackData(videoId,getKeys()),_0x7a05b1=CryptoJS.HmacSHA256(_0x51a035,_0x24a30a).toString(),app_key=CryptoJS.MD5("www.555dy.com").toString(),client_key=CryptoJS.MD5(VM_AGENT).toString(),request_token=CryptoJS.MD5("https://zyz.sdljwomen.com").toString(),access_token=CryptoJS.MD5(url3.replace("http:","").replace("https:","")).toString(),response=await send({url:`${url3}?app_key=${app_key}&client_key=${client_key}&request_token=${request_token}&access_token=${access_token}`,headers:{"X-PLAYER-TIMESTAMP":_0xe71271.toString(),"X-PLAYER-SIGNATURE":_0x7a05b1,"X-PLAYER-METHOD":"GET","X-PLAYER-PACK":_0x51a035}});assertOK(response);const html=response.body,json=JSON.parse(decryptPackData(html,getKeys()));return {url:json.data.url}}};