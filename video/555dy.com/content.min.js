exports=async function(a,b,c,d){function e(){return [g.enc.Utf8.parse("55ca5c48a943afdc"),g.enc.Utf8.parse("d11424dcecfe16c0")]}const{send:f}=require("http"),g=(await require("third-party/crypto-js"))(["aes","hmac","sha256"]),h=require("utils/absolute_url"),i={encoding:"utf-8",...d.clientOptions};let j;if(j=await f(a,i),200>j.statusCode||299<j.statusCode)throw new Error(`Request failed with statusCode ${j.statusCode}, ${j.reasonPhrase}`);let k=j.body,l=/var player_aaaa=({[^<]+})<\/script>(?:\s*<div[^>]*>)+\s*<iframe [^>]*src="([^"]+)"[^>]+allow="autoplay"/.exec(k);if(!l)return null;const m=JSON.parse(l[1].trim()),n=m.url;if(!n)return null;const o=h(l[2],a);if(j=await f({url:o,headers:{referer:a}},i),200>j.statusCode||299<j.statusCode)throw new Error(`Request failed with statusCode ${j.statusCode}, ${j.reasonPhrase}`);if(k=j.body,l=/servers\s*=\s*\[([^\[\]]+)]/.exec(k),!l)return;const p=l[1].split(",").map(a=>a.replace(/['"]/g,"").trim()),q=p[0],r=function(a){return g.HmacSHA256(a,"55ca5c4d11424dcecfe16c08a943afdc").toString()}(n),s=function(a){const b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b.buffer}(function(a){let[b,c]=e();const d=g.enc.Utf8.parse(a),f=g.AES.encrypt(d,b,{iv:c,mode:g.mode.CBC,padding:g.pad.Pkcs7});return f.ciphertext.toString().toUpperCase()}(JSON.stringify({type:"getUrl",url:n,sign:r})));let t;const u=await new Promise((a,b)=>{const c=require("websocket_client");t=new c(q,null,{headers:{Origin:o},onopen:function(){console.log("onopen"),t.send(s);},onerror:function(a){console.log("onerror "+a),null!=t&&t.close(),b();},onmessage:function(b){console.log(`onmessage ${b}`),a(b);}});});null!=t&&t.close();let v=JSON.parse(function(a){let[b,c]=e();const d=g.enc.Hex.parse(a),f=g.enc.Base64.stringify(d),h=g.AES.decrypt(f,b,{iv:c,mode:g.mode.CBC,padding:g.pad.Pkcs7});return h.toString(g.enc.Utf8)}(u));if("url"===v.type){if(!v.url)return console.log("missing url",v),null;console.log("videoUrl:",v.url);}return {url:v.url}};