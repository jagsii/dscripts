const{send}=require("http");async function fetchByPageUrl(a,b){let c=await send({url:a,headers:{referer:b}},{encoding:"utf-8"});assertOK(c);let d=c.body;const e=JSON.parse(d);return e.data[Object.keys(e.data)[0]].sort((c,a)=>c.tvId-a.tvId).map(a=>({id:/(v_[^.\/]+)\.html/.exec(a.playUrl)[1],name:a.name,url:a.playUrl}))}exports=async function(a,b){var c=Math.floor;const d=`https://m.iqiyi.com/${a}.html`;if(a.startsWith("v_"))return [{id:a,name:"\u5168\u96C6",url:d}];const[e,f]=b.recognizeExtra.split("+");if("year"===e){if(b.pageUrl){const a=await fetchByPageUrl(b.pageUrl,d);return a.forEach(a=>{a.url.startsWith("http://")&&(a.url=a.url.replace("http://","https://"));}),{paginate:{type:"urls",pageUrls:[],pageUrl:b.pageUrl},catalog:a}}let a=await send(d,{encoding:"utf-8","x-mobile":1});assertOK(a);let c=a.body;const e=c.subRegex(/window\.__INITIAL_STATE__=([^\n]+);\(function/);if(!e)return null;const g=JSON.parse(e),h="string"==typeof g.album.albumInfo.summaryInfo?[]:g.album.albumInfo.summaryInfo.map(a=>a.year).sort((c,a)=>c.localeCompare(a)).map(a=>`https://pcw-api.iqiyi.com/album/source/svlistinfo?sourceid=${f}&timelist=${a}`);let i,j=b.page??0;return 0===h.length?i=[]:(-1===j&&(j=h.length-1),i=await fetchByPageUrl(h[j],d),i.forEach(a=>{a.url.startsWith("http://")&&(a.url=a.url.replace("http://","https://"));})),{paginate:{type:"urls",pageUrls:h,pageUrl:h[j]},catalog:i}}else {const a=200;let e,g=b.page,h=b.chapterIndex;-1===g?(e=!0,g=null):e=!1,null==g&&(null==h?g=1:g=c(h/a)+1),1>g&&(g=1);let i=await send({url:`https://pcw-api.iqiyi.com/albums/album/avlistinfo?aid=${f}&size=${a}&page=${g}`,headers:{referer:d}},{encoding:"utf-8"});assertOK(i);let j=i.body,k=JSON.parse(j);const l=k.data.page;(e&&l>g||l<g)&&(g=l,i=await send({url:`https://pcw-api.iqiyi.com/albums/album/avlistinfo?aid=${f}&size=${a}&page=${g}`,headers:{referer:d}},{encoding:"utf-8"}),assertOK(i),j=i.body,k=JSON.parse(j));const m=k.data.epsodelist.map(a=>({id:/(v_[^.\/]+)\.html/.exec(a.playUrl)[1],name:a.name,url:a.playUrl}));return m.forEach(a=>{a.url.startsWith("http://")&&(a.url=a.url.replace("http://","https://"));}),{paginate:{pageNo:g,pageSize:a,totalPages:l},catalog:m}}};