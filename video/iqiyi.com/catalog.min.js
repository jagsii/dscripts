exports=async function(bid,options){var _Mathfloor=Math.floor;async function fetchByPageUrl(pageUrl,referer){let response=await send({url:pageUrl,headers:{referer}},{encoding:"utf-8"});assertOK(response);let html=response.body;const data=JSON.parse(html);return data.data[Object.keys(data.data)[0]].sort((a,b)=>a.tvId-b.tvId).map(_=>({id:/(v_[^.\/]+)\.html/.exec(_.playUrl)[1],name:_.name,url:_.playUrl}))}const{send}=require("http"),url=`https://m.iqiyi.com/${bid}.html`;if(bid.startsWith("v_"))return [{id:bid,name:"\u5168\u96C6",url:url}];const[type,vid]=options.recognizeExtra.split("+");if("year"===type){if(options.pageUrl){const catalog=await fetchByPageUrl(options.pageUrl,url);return catalog.forEach(_=>{_.url.startsWith("http://")&&(_.url=_.url.replace("http://","https://"));}),formatCatalog({paginate:{type:"urls",pageUrls:[],pageUrl:options.pageUrl},catalog})}let response=await send(url,{encoding:"utf-8","x-mobile":1});assertOK(response);let html=response.body;const stateStr=html.subRegex(/window\.__INITIAL_STATE__=([^\n]+);\(function/);if(!stateStr)return null;const state=JSON.parse(stateStr),pageUrls="string"==typeof state.album.albumInfo.summaryInfo?[]:state.album.albumInfo.summaryInfo.map(_=>_.year).sort((a,b)=>a.localeCompare(b)).map(_=>`https://pcw-api.iqiyi.com/album/source/svlistinfo?sourceid=${vid}&timelist=${_}`);let catalog,page=options.page??0;return 0===pageUrls.length?catalog=[]:(-1===page&&(page=pageUrls.length-1),catalog=await fetchByPageUrl(pageUrls[page],url),catalog.forEach(_=>{_.url.startsWith("http://")&&(_.url=_.url.replace("http://","https://"));})),formatCatalog({paginate:{type:"urls",pageUrls,pageUrl:pageUrls[page]},catalog})}else {const pageSize=200;let fetchLast,page=options.page,chapterIndex=options.chapterIndex;-1===page?(fetchLast=!0,page=null):fetchLast=!1,null==page&&(null==chapterIndex?page=1:page=_Mathfloor(chapterIndex/pageSize)+1),1>page&&(page=1);let response=await send({url:`https://pcw-api.iqiyi.com/albums/album/avlistinfo?aid=${vid}&size=${pageSize}&page=${page}`,headers:{referer:url}},{encoding:"utf-8"});assertOK(response);let html=response.body,data=JSON.parse(html);const totalPages=data.data.page;(fetchLast&&totalPages>page||totalPages<page)&&(page=totalPages,response=await send({url:`https://pcw-api.iqiyi.com/albums/album/avlistinfo?aid=${vid}&size=${pageSize}&page=${page}`,headers:{referer:url}},{encoding:"utf-8"}),assertOK(response),html=response.body,data=JSON.parse(html));const catalog=data.data.epsodelist.map(_=>({id:/(v_[^.\/]+)\.html/.exec(_.playUrl)[1],name:_.name,url:_.playUrl}));return catalog.forEach(_=>{_.url.startsWith("http://")&&(_.url=_.url.replace("http://","https://"));}),formatCatalog({paginate:{pageNo:page,pageSize,totalPages},catalog})}};