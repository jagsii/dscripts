const{send}=require("http");async function fetchByPageUrl(a,b){let c=await send({url:a,headers:{referer:b}},{encoding:"utf-8"});assertOK(c);let d=c.body;const e=JSON.parse(d);return e.data[Object.keys(e.data)[0]].sort((c,a)=>c.tvId-a.tvId).map(a=>({id:/(v_[^.\/]+)\.html/.exec(a.playUrl)[1],name:a.name,url:a.playUrl}))}exports=async function(a,b){const c=`https://m.iqiyi.com/${a}.html`;if(a.startsWith("v_"))return [{id:a,name:"\u5168\u96C6",url:c}];const[d,e]=b.recognizeExtra.split("+");if("year"===d){if(b.pageUrl){const a=await fetchByPageUrl(b.pageUrl,c);return {type:"urls_paginated",paginate:{pageUrls:[],pageUrl:b.pageUrl},catalog:a}}let a=await send(c,{encoding:"utf-8","x-mobile":1});assertOK(a);let d=a.body;const f=d.subRegex(/window\.__INITIAL_STATE__=([^\n]+);\(function/);if(!f)return null;const g=JSON.parse(f),h=g.album.albumInfo.summaryInfo.map(a=>a.year).sort((c,a)=>c.localeCompare(a)).map(a=>`https://pcw-api.iqiyi.com/album/source/svlistinfo?sourceid=${e}&timelist=${a}`);let i=b.page??0;-1===i&&(i=h.length-1);const j=await fetchByPageUrl(h[i],c);return {type:"urls_paginated",paginate:{pageUrls:h,pageUrl:h[i]},catalog:j}}else {const a=200;let d,f=b.page,g=b.chapterIndex;-1===f?(d=!0,f=null):d=!1,null==f&&(null==g?f=1:f=Math.floor(g/a)+1),1>f&&(f=1);let h=await send({url:`https://pcw-api.iqiyi.com/albums/album/avlistinfo?aid=${e}&size=${a}&page=${f}`,headers:{referer:c}},{encoding:"utf-8"});assertOK(h);let i=h.body,j=JSON.parse(i);const k=j.data.page;(d&&k>f||k<f)&&(f=k,h=await send({url:`https://pcw-api.iqiyi.com/albums/album/avlistinfo?aid=${e}&size=${a}&page=${f}`,headers:{referer:c}},{encoding:"utf-8"}),assertOK(h),i=h.body,j=JSON.parse(i));const l=j.data.epsodelist.map(a=>({id:/(v_[^.\/]+)\.html/.exec(a.playUrl)[1],name:a.name,url:a.playUrl}));return {paginate:{pageNo:f,pageSize:a,totalPages:k},catalog:l}}};