function getNodeHost(b,c,d=256){var e=b.match(/images\/\w\/(.{2})/i),a=1;null!==e&&e[1]&&(a=parseInt("0x"+e[1],16));var f=c,g=0;f.forEach(function(a){"string"==typeof a&&(a={weight:1,value:a}),a.value&&(g+=a.weight?a.weight:1);}),g=0<g?g:1;var h=null,i=0;return f.forEach(function(b){null===h&&("string"==typeof b&&(b={weight:1,value:b}),b.value&&(i+=(b.weight?b.weight:1)/g*d,i>a&&(h=b.value)));}),h}async function parseContent(a,b){b=b||{};const c={url:a,...b.httpOptions},d={encoding:"utf-8",...b.clientOptions};let e;if(b.webview){const c=require("webview_fetch");e=await c(a,{mobile:1===d["x-mobile"],...b.webviewOptions});}else {stat("request");const{send:f}=require("http");let g=await f(c,d);if(stat("request"),b.fallbackToWebview&&b.fallbackToWebview(g)){const c=require("webview_fetch");e=await c(a,{mobile:1===d["x-mobile"],...b.webviewOptions});}else assertOK(g),e=g.body;}const{chapterImages:f,nodeHost:g,nodeHosts:h}=e.subRegexMap(/var chapterImages\s*=\s*(?<chapterImages>\[[^\]]+\]);[^<]*?var nodeHost\s*=\s*"(?<nodeHost>[^"]*)";[^<]*?var nodeHosts\s*=\s*(?<nodeHosts>\[[^;]*\]);/),{getCih:i,getCirh:j}=e.subRegexMap(/function getCih\(\)\{\s*return ["'](?<getCih>[^"']+)["'];\s*\}<\/script>\s*<script>function getCirh\(\)\{return ["'](?<getCirh>[^"']+)["'];/),k=e.subRegex(/var chapterImageHost\s*=\s*"([^"]*)";/),l=e.subRegex(/var chapterImageRHost\s*=\s*"([^"]*)";/);var m=k?k:"";i!==void 0&&(m=i);let n=l?l:"";j!==void 0&&(n=j);const o=JSON.parse(h),p=JSON.parse(f.replace(/\\/g,"")).map(a=>n&&/^(\/[rz]\/?)/i.test(a)?n+a:/^(\/p\/?)/i.test(a)?g+a:/^\/images\/p\//i.test(a)?getNodeHost(a,o)+a:m&&/^(\/|images?)/i.test(a)?m+a:a);return {urls:p}}exports.getNodeHost=getNodeHost,exports.parseContent=parseContent;