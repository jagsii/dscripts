async function redirectCookiesRetry(a,b,c,d){return !(3<d)&&(302===a.statusCode?!!a.headers["set-cookie"]&&(b.headers||(b.headers={}),b.headers.Cookie=a.headers["set-cookie"].split(",").map(a=>{let b=a.indexOf(";");return -1===b?a.trim():a.substring(0,b).trim()}).join("; "),!0):void 0)}function getTagNameEndPos(a,b){let d,e=b;if(a.length<=b+1)return -1;if(d=a.charAt(e),"/"===d&&(e=b+1,d=a.charAt(e)),a.length<=e+1)return -1;if(!("a"<=d&&"z">=d||"A"<=d&&"Z">=d))return -1;for(let c=e+1;c<a.length;c++)if(d=a.charAt(c),!("a"<=d&&"z">=d||"A"<=d&&"Z">=d||"0"<=d&&"9">=d||"-"===d||"_"===d))return c;return b+1}function getTagEndPos(a,b){let d,e=null;for(let c=b;c<a.length;c++){if(d=a.charAt(c),"\""===d||"'"===d){if(d===e){e=null;continue}if(null==e){e=d;continue}}if(null==e&&">"===d)return c+1}return -1}const optionalClosingTags=["img","link","input","br","hr","meta"];function isRootNode(a){let b=0;for(let c=a.length-1;-1<c;c--){const d=a[c];if(""!==d.tag){if(1===d.closing){b++;continue}if(0===d.closing&&-1===optionalClosingTags.indexOf(d.tag)&&0==b--)return !1}}return !0}function getClosingScript(a,b){let d,e;for(let c=b;c<a.length;c++){if(d=a.charAt(c),"\""===d||"'"===d||"`"===d){if("\\"===a.charAt(c-1))continue;if(d===e){e=void 0;continue}e=d;continue}if(void 0===e&&"<"===d)return c}return -1}function trySkipComment(a,b){if(b+3<a.length&&"!--"===a.substring(b,b+3)){const c=a.indexOf("-->",b+3);return -1===c?-1:c+3}return -1}const whiteSpaceEntityNames=["nbsp","ensp","emsp"],htmlWhiteSpaceChars=[" ","\u3000","\r","\n","\t"];function collectHtmlTags(a){const b=!1,d=[],e=a.length;let f;for(let c=0;c<e;c++)if(f=a.charAt(c),"<"===f){const f=trySkipComment(a,c+1);if(-1!==f){d.push({tag:"",begin:c,end:f,data:b?a.substring(c,f):void 0}),c=f-1;continue}let g=getTagNameEndPos(a,c+1);if(-1!==g){const f=0===d.length?0:d[d.length-1].end;f<c&&d.push({tag:"",begin:f,end:c,data:b?a.substring(f,c):void 0});const h="/"===a.charAt(c+1),i=a.substring(c+(h?2:1),g).toLowerCase();let j=getTagEndPos(a,g);-1===j&&(j=e);let k=h?1:0;if(h||"/"!==a.charAt(j-2)||(k=2),d.push({tag:i,closing:k,begin:c,end:j,data:b?a.substring(c,j):void 0}),"script"===i&&0===k){const e=getClosingScript(a,j);if(-1!==e){d.push({tag:"",begin:j,end:e,data:b?a.substring(j,e):void 0}),c=e-1;continue}}c=j-1;}}return d}function removeLeadingNonContentTags(a){const b=!1,d=[],e=a.length;let f;for(let c=0;c<e;c++){if(f=a.charAt(c),"&"===f&&c+6<e&&";"===a.charAt(c+5)&&-1!==whiteSpaceEntityNames.indexOf(a.substring(c+1,c+5))){c+=5;continue}if("<"===f){const f=trySkipComment(a,c+1);if(-1!==f){d.push({tag:"",begin:c,end:f,data:b?a.substring(c,f):void 0}),c=f-1;continue}let g=getTagNameEndPos(a,c+1);if(-1!==g){const f=0===d.length?0:d[d.length-1].end;f<c&&d.push({tag:"",begin:f,end:c,data:b?a.substring(f,c):void 0});const h="/"===a.charAt(c+1),i=a.substring(c+(h?2:1),g).toLowerCase();let j=getTagEndPos(a,g);-1===j&&(j=e);let k=h?1:0;if(h||"/"!==a.charAt(j-2)||(k=2),"p"===i&&0===k&&isRootNode(d))return a.substring(c);if(d.push({tag:i,closing:k,begin:c,end:j,data:b?a.substring(c,j):void 0}),"script"===i&&0===k){const e=getClosingScript(a,j);if(-1!==e){d.push({tag:"",begin:j,end:e,data:b?a.substring(j,e):void 0}),c=e-1;continue}}c=j-1;}continue}if(-1===htmlWhiteSpaceChars.indexOf(f)&&isRootNode(d))return a.substring(c)}return a}exports.redirectCookiesRetry=redirectCookiesRetry,exports.collectHtmlTags=collectHtmlTags,exports.removeLeadingNonContentTags=removeLeadingNonContentTags;