async function redirectCookiesRetry(response,httpOptions,clientOptions,count){return !(3<count)&&(302===response.statusCode?!!response.headers["set-cookie"]&&(httpOptions.headers||(httpOptions.headers={}),httpOptions.headers.Cookie=response.headers["set-cookie"].split(",").map(_=>{let i=_.indexOf(";");return -1===i?_.trim():_.substring(0,i).trim()}).join("; "),!0):void 0)}function getTagNameEndPos(html,start){let c,_start=start;if(html.length<=start+1)return -1;if(c=html.charAt(_start),"/"===c&&(_start=start+1,c=html.charAt(_start)),html.length<=_start+1)return -1;if(!("a"<=c&&"z">=c||"A"<=c&&"Z">=c))return -1;for(let i=_start+1;i<html.length;i++)if(c=html.charAt(i),!("a"<=c&&"z">=c||"A"<=c&&"Z">=c||"0"<=c&&"9">=c||"-"===c||"_"===c))return i;return start+1}function getTagEndPos(html,start){let c,inQuote=null;for(let i=start;i<html.length;i++){if(c=html.charAt(i),"\""===c||"'"===c){if(c===inQuote){inQuote=null;continue}if(null==inQuote){inQuote=c;continue}}if(null==inQuote&&">"===c)return i+1}return -1}const optionalClosingTags=["img","link","input","br","hr","meta"];function isRootNode(nodes){let unclosed=0;for(let i=nodes.length-1;-1<i;i--){const node=nodes[i];if(""!==node.tag){if(1===node.closing){unclosed++;continue}if(0===node.closing&&-1===optionalClosingTags.indexOf(node.tag)&&0==unclosed--)return !1}}return !0}function getClosingScript(html,start){let c,quoting;for(let i=start;i<html.length;i++){if(c=html.charAt(i),"\""===c||"'"===c||"`"===c){if("\\"===html.charAt(i-1))continue;if(c===quoting){quoting=void 0;continue}quoting=c;continue}if(void 0===quoting&&"<"===c)return i}return -1}function trySkipComment(html,start){if(start+3<html.length&&"!--"===html.substring(start,start+3)){const pos=html.indexOf("-->",start+3);return -1===pos?-1:pos+3}return -1}const whiteSpaceEntityNames=["nbsp","ensp","emsp"],htmlWhiteSpaceChars=[" ","\u3000","\r","\n","\t"];function collectHtmlTags(html){const debug=!1,nodes=[],length=html.length;let c;for(let i=0;i<length;i++)if(c=html.charAt(i),"<"===c){const commentPos=trySkipComment(html,i+1);if(-1!==commentPos){nodes.push({tag:"",begin:i,end:commentPos,data:debug?html.substring(i,commentPos):void 0}),i=commentPos-1;continue}let _tagNameEnd=getTagNameEndPos(html,i+1);if(-1!==_tagNameEnd){const prevEnd=0===nodes.length?0:nodes[nodes.length-1].end;prevEnd<i&&nodes.push({tag:"",begin:prevEnd,end:i,data:debug?html.substring(prevEnd,i):void 0});const closed="/"===html.charAt(i+1),tag=html.substring(i+(closed?2:1),_tagNameEnd).toLowerCase();let tagEnd=getTagEndPos(html,_tagNameEnd);-1===tagEnd&&(tagEnd=length);let closing=closed?1:0;if(closed||"/"!==html.charAt(tagEnd-2)||(closing=2),nodes.push({tag,closing,begin:i,end:tagEnd,data:debug?html.substring(i,tagEnd):void 0}),"script"===tag&&0===closing){const closingScript=getClosingScript(html,tagEnd);if(-1!==closingScript){nodes.push({tag:"",begin:tagEnd,end:closingScript,data:debug?html.substring(tagEnd,closingScript):void 0}),i=closingScript-1;continue}}i=tagEnd-1;}}return nodes}function removeLeadingNonContentTags(html){const debug=!1,nodes=[],length=html.length;let c;for(let i=0;i<length;i++){if(c=html.charAt(i),"&"===c&&i+6<length&&";"===html.charAt(i+5)&&-1!==whiteSpaceEntityNames.indexOf(html.substring(i+1,i+5))){i+=5;continue}if("<"===c){const commentPos=trySkipComment(html,i+1);if(-1!==commentPos){nodes.push({tag:"",begin:i,end:commentPos,data:debug?html.substring(i,commentPos):void 0}),i=commentPos-1;continue}let _tagNameEnd=getTagNameEndPos(html,i+1);if(-1!==_tagNameEnd){const prevEnd=0===nodes.length?0:nodes[nodes.length-1].end;prevEnd<i&&nodes.push({tag:"",begin:prevEnd,end:i,data:debug?html.substring(prevEnd,i):void 0});const closed="/"===html.charAt(i+1),tag=html.substring(i+(closed?2:1),_tagNameEnd).toLowerCase();let tagEnd=getTagEndPos(html,_tagNameEnd);-1===tagEnd&&(tagEnd=length);let closing=closed?1:0;if(closed||"/"!==html.charAt(tagEnd-2)||(closing=2),"p"===tag&&0===closing&&isRootNode(nodes))return html.substring(i);if(nodes.push({tag,closing,begin:i,end:tagEnd,data:debug?html.substring(i,tagEnd):void 0}),"script"===tag&&0===closing){const closingScript=getClosingScript(html,tagEnd);if(-1!==closingScript){nodes.push({tag:"",begin:tagEnd,end:closingScript,data:debug?html.substring(tagEnd,closingScript):void 0}),i=closingScript-1;continue}}i=tagEnd-1;}continue}if(-1===htmlWhiteSpaceChars.indexOf(c)&&isRootNode(nodes))return html.substring(i)}return html}exports.redirectCookiesRetry=redirectCookiesRetry,exports.collectHtmlTags=collectHtmlTags,exports.removeLeadingNonContentTags=removeLeadingNonContentTags;