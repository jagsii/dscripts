exports = async function (videoUrl, options) {
  const {
    send
  } = require('http');

  const URL = require('url');

  const url1 = `https://jx.playerjy.com/?url=${videoUrl}`;
  let response = await send(url1);
  assertOK(response);
  let html = response.body;
  let url2 = html.subRegex(/<iframe [^>]*src="([^"]+url=[^"]+)"/);

  if (!url2) {
    return null;
  }

  const uri2 = new URL(url2, url1);
  url2 = uri2.toString();
  response = await send({
    url: url2,
    headers: {
      'Referer': url1
    }
  });
  assertOK(response);
  html = response.body;
  const configStr = html.subRegex(/var config\s*=\s*({(?:\s*"[^"]+"\s*:\s*(?:[\d.]+|"[^"]*"),)*\s*"[^"]+"\s*:\s*(?:[\d.]+|"[^"]*"),?\s*})/);

  if (!configStr) {
    return null;
  }

  const config = JSON.parse(configStr.replace(/,\s*}/, '}').trim());

  if (!config.url) {
    return null;
  }

  response = await send({
    url: uri2.resolve('API.php'),
    method: 'POST',
    headers: {
      'Referer': url2,
      'X-Requested-With': 'XMLHttpRequest',
      'Content-Type': 'application/x-www-form-urlencoded'
    },
    body: `url=${encodeURIComponent(config['url'])}&time=${config['time']}&key=${config['key']}`
  });
  assertOK(response);
  html = response.body;
  const data = JSON.parse(html);

  if (data['code'] != 200) {
    return null;
  }

  let result = data['url'];
  return {
    url: result
  };
};